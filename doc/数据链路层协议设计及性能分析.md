# 数据链路层协议设计及性能分析

## 帧长与误码率

在传输的每个数据帧时,势必加入一些与传输数据无关的控制信息,比如滑动窗口的序号,CRC校验值,捎带的ACK/NAK标志位.

所以,先提出一个有效传输率的概念,即数据的长度和实际传输帧的比值.


$$
U=\frac{L_{data}}{L_{frame}}\times 100\%
$$

$$
L_{frame}=L_{data}+L_{con}
$$

> $L_{con}$代表每个数据帧中除了数据以外其他控制信息的长度.

那么从利用率上来讲,在控制信息长度不变的情况下,数据长度越大,利用率越高.但是,这只是在信道是无噪声的情况下,如果信道有噪声呢?

假设每发送一个字节出错的概率为p,那么帧长度$L_{frame}$越大,它出错的概率也就越大.它出错的概率为
$$
p_{frame}=1-(1-p)^{L_{frame}}
$$
通过计算可以得出(几何分布),一帧平均需要发送的次数为
$$
\frac{1}{p_{frame}}
$$
再接下来可以得出,在已知的误码率和控制信息长度后,信道的有效传输率为
$$
U=(1-p_{frame})^{L_{frame}}\times(1-\frac{L_{con}}{L_{frame}})\times 100 \%
$$
在本次实验中,默认信道每比特误码率为1e-5,那么每字节的误码率为$1-(1-p)^8\approx8e-5$

假设我们每帧的控制信息长度取8字节,那么下面是帧长度与利用率的关系图:

<img src="http://cdn.riversjin.top/images/test.png" style="zoom: 50%;" />

由此看出,在不同误码率下,若要使有效传输率尽可能大,需要采用不同的帧长.在误码率为1e-5的情况下,我们可以看到当帧长为300左右时利用率最佳,而在1e-4时帧长为100左右时最佳.当然我们认为一个成熟的链路层协议应该学会自己选择最佳的帧长,所以我们决定在将这个链路层协议设计为可变帧长.在图中我们可以看到即使是1e-6的误码率,在长度为1000时的效率也没有明显下降,所以,我们设定帧的可变长度为64~1024byte.

在这个协议中,会有以下4四种帧:

1. Data with ACK/NAK
2. Data
3. ACK
4. NAK
